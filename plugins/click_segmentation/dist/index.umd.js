(function(l,p){typeof exports=="object"&&typeof module<"u"?p(require("@fiftyone/plugins"),require("@fiftyone/operators"),require("@fiftyone/state"),require("recoil"),require("react")):typeof define=="function"&&define.amd?define(["@fiftyone/plugins","@fiftyone/operators","@fiftyone/state","recoil","react"],p):(l=typeof globalThis<"u"?globalThis:l||self,p(l.__fop__,l.__foo__,l.__fos__,l.recoil,l.React))})(this,function(l,p,w,z,s){"use strict";function F(n){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const r in n)if(r!=="default"){const i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(o,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}return o.default=n,Object.freeze(o)}const O=F(w);function N(){var v;const n=z.useRecoilValue(O.modalSample),[o,r]=s.useState([]),[i,P]=s.useState(!1),[t,W]=s.useState(!1),[S,_]=s.useState(!1),[m,A]=s.useState("user_clicks"),[x,X]=s.useState("segment-anything-2-hiera-tiny-image-torch"),[y,Y]=s.useState("label");s.useEffect(()=>{r([])},[(v=n==null?void 0:n.sample)==null?void 0:v._id]),s.useEffect(()=>{if(!i||!n)return;const e=async a=>{const g=a.target;if(g.tagName!=="CANVAS"||S)return;const c=g.getBoundingClientRect(),d=n.sample.metadata;if(!(d!=null&&d.width)||!(d!=null&&d.height)){console.error("No image metadata available");return}const h=d.width/d.height,I=c.width/c.height;let f,u,b,k;h>I?(f=c.width,u=c.width/h,b=0,k=(c.height-u)/2):(u=c.height,f=c.height*h,b=(c.width-f)/2,k=0);const $=a.clientX-c.left,K=a.clientY-c.top,C=$-b,R=K-k;if(C<0||C>f||R<0||R>u){console.log("Click outside image bounds");return}const L=C/f,M=R/u,E={normalizedX:parseFloat(L.toFixed(4)),normalizedY:parseFloat(M.toFixed(4))};console.log("Click captured:",E),t?await T(E):r(V=>[...V,E])};return document.addEventListener("click",e,!0),()=>document.removeEventListener("click",e,!0)},[i,n,t,S,x,m]);const D=async()=>{if(!m.trim()){alert("Please enter a field name");return}const e=o.map(a=>[a.normalizedX,a.normalizedY]);try{await p.executeOperator("@51labs/click_segmentation/save_keypoints",{keypoints:e,field_name:m.trim(),label_name:y.trim()}),r([])}catch(a){console.error("Error saving keypoints:",a),alert(`Failed: ${a.message}`)}},T=async e=>{_(!0);const a=[[e.normalizedX,e.normalizedY]];try{console.log("Auto segmenting with ",e),await p.executeOperator("@51labs/click_segmentation/save_keypoints",{keypoints:a,field_name:m.trim(),label_name:y.trim()}),await new Promise(g=>setTimeout(g,10)),await p.executeOperator("@51labs/click_segmentation/segment_with_prompts",{prompt_field:m.trim(),model_name:x.trim()}),r([])}catch(g){console.error("Error auto segmenting:",g),alert(`Failed: ${g.message}`)}finally{_(!1)}},j=async()=>{try{await p.executeOperator("@51labs/click_segmentation/segment_with_prompts",{prompt_field:m.trim(),model_name:x.trim()})}catch(e){console.error("Error saving keypoints:",e),alert(`Failed: ${e.message}`)}},q=()=>{r([])};return React.createElement("div",{style:{padding:"20px",display:"flex",flexDirection:"column",height:"100%"}},React.createElement("div",{style:{marginBottom:"10px"}},React.createElement("h3",{style:{margin:0}},"Image segmentation via point prompts")),React.createElement("div",{style:{marginBottom:"20px",display:"flex",flexDirection:"column",padding:"15px",backgroundColor:i?"#e3f2fd":"#f5f5f5",borderRadius:"8px",border:`2px solid ${i?"#2196F3":"#ddd"}`,transition:"all 0.3s ease"}},React.createElement("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"}},React.createElement("input",{type:"checkbox",checked:i,onChange:e=>P(e.target.checked),style:{width:"20px",height:"20px",cursor:"pointer"}}),React.createElement("span",{style:{fontWeight:"bold",fontSize:"15px",color:i?"#1976d2":"#666"}},i?"Capturing Clicks":"Activate Click Capture")),i&&React.createElement("p",{style:{fontSize:"12px",color:"#1976d2",margin:"8px 0 0 30px",fontWeight:"500"}},"Click anywhere on the modal image to capture keypoints.")),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Sample field name for saving clicks (as keypoints)"),React.createElement("input",{type:"text",value:m,onChange:e=>A(e.target.value),placeholder:"e.g., user_clicks, keypoints",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Label name for the current set of clicks"),React.createElement("input",{type:"text",value:y,onChange:e=>Y(e.target.value),placeholder:"e.g., animal, person",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"20px",display:"flex",flexDirection:"column",padding:"15px",backgroundColor:t?"#e3f2fd":"#f5f5f5",borderRadius:"8px",border:`2px solid ${t?"#2196F3":"#ddd"}`,transition:"all 0.3s ease"}},React.createElement("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"}},React.createElement("input",{type:"checkbox",checked:t,onChange:e=>W(e.target.checked),style:{width:"20px",height:"20px",cursor:"pointer"}}),React.createElement("span",{style:{fontWeight:"bold",fontSize:"15px",color:t?"#1976d2":"#666"}},t?"Single Click Segmentation":"Enable Single Click Segmentation")),t&&React.createElement("p",{style:{fontSize:"12px",color:"#1976d2",margin:"8px 0 0 30px",fontWeight:"500"}},"Single click segmentation is enabled. Clicking on the modal will auto-generate segmentation.")),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:D,disabled:t||o.length===0,style:{padding:"8px 16px",backgroundColor:!t&&o.length>0?"#2196F3":"#ccc",color:"white",border:"none",borderRadius:"4px",cursor:!t&&o.length>0?"pointer":"not-allowed",fontWeight:"bold"}},"Save as Keypoints (",o.length,")"),React.createElement("button",{onClick:q,disabled:t||o.length===0,style:{padding:"8px 16px",backgroundColor:!t||o.length>0?"#2196F3":"#ccc",color:"white",border:"none",borderRadius:"4px",cursor:!t&&o.length>0?"pointer":"not-allowed"}},"Clear Clicks (",o.length,")")),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Promptable segmentation model from FiftyOne model zoo"),React.createElement("input",{type:"text",value:x,onChange:e=>X(e.target.value),placeholder:"e.g., segment-anything-2-hiera-small-image-torch",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:j,disabled:t,style:{padding:"8px 16px",backgroundColor:t?"#ccc":"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:t?"not-allowed":"pointer",fontWeight:"bold"}},"Segment with keypoints")))}l.registerComponent({name:"ClickSegmentation",label:"Click To Segment",component:N,type:l.PluginComponentType.Panel,activator:B,panelOptions:{surfaces:"modal"}});function B({dataset:n}){return!0}});
//# sourceMappingURL=index.umd.js.map
